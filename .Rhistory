difftime(as.POSIXct(input, format = '%H%M'), as.POSIXct('0000', format = '%H%M'), units = 'min')
}
diff_in_time(0530)
?difftime
diff_in_time <- function(input){
input = formatC(sprintf("%04d", input), width=4, flag="0")
difftime(as.POSIXct(input, format = '%H%M'), as.POSIXct('0000', format = '%H%M'))
}
diff_in_time(0530)
?difftime
diff_in_time <- function(input){
input = formatC(sprintf("%04d", input), width=4, flag="0")
difftime(as.POSIXct(input, format = '%H%M'), as.POSIXct('0000', format = '%H%M'), units = 'min')
}
diff_in_time(0530)
flights$sched_dep_time_min <- lapply(flights$sched_dep_time, diff_in_time)
print(diff_in_time(0530))
a <- diff_in_time(0530)
a
class(a)
as.double(a)
diff_in_time <- function(input){
input = formatC(sprintf("%04d", input), width=4, flag="0")
as.double(difftime(as.POSIXct(input, format = '%H%M'), as.POSIXct('0000', format = '%H%M'), units = 'min'))
}
diff_in_time(0530)
flights$sched_dep_time_min <- lapply(flights$sched_dep_time, diff_in_time)
flights$sched_dep_time_min
flights[is.na(flights$dep_time)] <- 0
flights$dep_time[is.na(flights$dep_time)] <- 0
min(flights$dep_time)
filter(flights, is.na(flights$dep_time))
flights$dep_time_min <- lapply(flights$dep_time, diff_in_time)
flights$air_time
head(flights)
head(select(flights, head, arr_time, dep_time))
select(flights, head, arr_time, dep_time)
head(select(flights, arr_time, dep_time))
head(select(flights, arr_time, dep_time, air_time))
flights
head(select(flights, arr_time, dep_time, air_time))
select(flights,origin, dest)
flights
filter(flights, origin="SG")
filter(flights, origin=="SG")
flights >%> count(dest)
flights >%> count(flights, dest)
flights >%> count(dest, origin)
flights %>% count(dest, origin)
filter(flights, dest = "JFK")
filter(flights, dest == "JFK")
filter(flights, dest == "ABQ", origin=="JFK")
filtered_jfk_abq <- filter(flights, dest == "ABQ", origin=="JFK")
select(filtered_jfk_abq, origin, dest, arr_time, dep_time, air_time)
a <- select(filtered_jfk_abq, origin, dest, arr_time, dep_time, air_time)
a$diff = a$dep_time - a$arr_time
a
a$diff = a$arr_time - a$dep_time
a
a$diff_air_time_diff <- a$air_time - a$diff
a
select(floghts, dep_time, sched_dep_time, dep_delay)
select(flights, dep_time, sched_dep_time, dep_delay)
# By right, sched_dep_time + dep_delay = dep_time
flights$test <- flights$sched_dep_time + flights$dep_delay
flights$test
flights
select(flights, sched_dep_time, dep_delay, dep_time, test)
# By right, sched_dep_time + dep_delay = dep_time
flights$test <- flights$sched_dep_time - flights$dep_time
flights$test
flights$test_diff <- flights$test - flights$dep_delay
flights$test_diff
flights$test_diff
select(flights, sched_dep_time, dep_delay, dep_time, test, test_diff)
# By right, sched_dep_time + dep_delay = dep_time
flights$test <- flights$dep_time - flights$sched_dep_time
flights$test_diff <- flights$test - flights$dep_delay
flights$test_diff
select(flights, sched_dep_time, dep_delay, dep_time, test, test_diff)
# 4. Find the 10 most delayed flights using a ranking function.
# How do you want to handle ties? Carefully read the documentation for min_rank().
?min_rank
flights
# to find the most delayed flights, we only use arr_delay, cause anytime at the scheduled
# delay is made up for
arrange(flights, arr_delay)
?arrange
# to find the most delayed flights, we only use arr_delay, cause anytime at the scheduled
# delay is made up for
arrange(flights, desc(arr_delay ))
?min_rank
x <- c(5, 1, 3, 2, 2, NA)
min_rank(x)
rank(flights, desc(arr_delay))
rank(desc(flights$arr_delay))
?rank
min_rank(desc(flights$arr_delay))
a <- min_rank(desc(flights$arr_delay))
a
filter(a < 10)
filter(a, a <=10)
class(a)
a
a[1]
class(a[1])
flights$rank <- min_rank(desc(flights$arr_delay))
filter(flights, flights$rank < 10)
select(filter(flights, flights$rank < 10),rank, arr_delay)
# 5. What does 1:3 + 1:10 return? Why?
1:3 + 1:10
1:3
not_cancelled <- flights %>%
filter(!is.na(dep_delay), !is.na(arr_delay))
not_cancelled %>% count(dest)
not_cancelled <- flights %>%
filter(!is.na(dep_delay), !is.na(arr_delay))
not_cancelled %>% count(dest)
not_cancelled
table(not_cancelled$dest)
not_cancelled %>% count(dest)
table(not_cancelled$dest)
not_cancelled %>% count(tailnum, wt = distance)
not_cancelled %>% count(tailnum, wt = distance)
filter(not_cancelled, tailnum = "D942DN")
filter(not_cancelled, tailnum == "D942DN")
filter(not_cancelled, tailnum == "D942DN")$distance
sum(filter(not_cancelled, tailnum == "D942DN")$distance)
?table
table(not_cancelled$tailnum)
aggregate(not_cancelled$tailnum)
aggregate(not_cancelled$tailnum, FUN=sum)
aggregate(not_cancelled$tailnum, by=not_cancelled$distance, FUN=sum)
aggregate(not_cancelled$tailnum, by=list(not_cancelled$distance), FUN=sum)
aggregate(not_cancelled$distance, by=list(not_cancelled$tailnum), FUN=sum)
# 4. Look at the number of cancelled flights per day.
# Is there a pattern?
# Is the proportion of cancelled flights related to the average delay?
flights
library(nycflights13)
library(tidyverse)
# 4. Look at the number of cancelled flights per day.
# Is there a pattern?
# Is the proportion of cancelled flights related to the average delay?
flights
filter(flights, is.na(dep_time))
cancelled_flights <- filter(flights, is.na(dep_time))
cancelled_flights %>%
count(month,day)
flights %>%
count(month,day)
all_flights <- flights %>%
count(month,day)
all_flights %>% left_join(cancelled_flights)
cancelled <- cancelled_flights %>%
count(month,day)
all_flights <- flights %>%
count(month,day)
all_flights %>% left_join(cancelled)
all_flights %>% left_join(cancelled, by=c("month", "day"))
combined_df <- all_flights %>% left_join(cancelled, by=c("month", "day"))
combined_df$proportion <- combined_df$n.y / combined_df$n.x
combined_df
combined_df$proportion <- (combined_df$n.y / combined_df$n.x)*100
combined_df
flights
flights %>%
by_day <- group_by(flights, year, month, day)
summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
by_day <- group_by(flights, year, month, day)
summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
min(flights$year)
max(flights$year)
avg_delay <- summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
by_day <- group_by(flights, month, day)
avg_delay <- summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
avg_delay
combined_df %>% left_join(avg_delay, by=c("month", "day"))
final_df <- combined_df %>% left_join(avg_delay, by=c("month", "day"))
library(ggplot2)
ggplot(data=final_df) + geom_point(mapping = aes(x=proportion, y=delay))
ggplot(data=final_df) + geom_point(mapping = aes(y=proportion, x=delay))
filter(final_df, proportion > 50)
carrier <- group_by(flights, carrier)
summarise(carrier, count(carrier))
count(flights, carrier)
by_day <- group_by(flights, carrier)
by_car <- group_by(flights, carrier)
avg_delay <- summarise(by_car, delay = mean(dep_delay, na.rm = TRUE))
avg_delay
arrange(avg_delay, delay)
# Can I disentagle effects of bad airports vs bad carriers
flights %>% group_by(carrier, dest) %>% summarise(n())
%>% group_by(carrier, dest) %>% summarise(n())
# Can I disentagle effects of bad airports vs bad carriers
flights %>%
group_by(carrier, dest) %>%
summarise(n())
# Can I disentagle effects of bad airports vs bad carriers
flights %>%
group_by(carrier, dest) %>%
summarise(delay=mean(dep_delay, na.rm=TRUE))
# Can I disentagle effects of bad airports vs bad carriers
flights %>%
group_by(carrier, dest) %>%
summarise(delay=mean(dep_delay, na.rm=TRUE)) %>%
left_join(flights %>%
group_by(carrier, dest) %>%
summarise(n()), by=c("carrier", "dest"))
# Can I disentagle effects of bad airports vs bad carriers
df_flights_delay_by_carrier_airport <- flights %>%
group_by(carrier, dest) %>%
summarise(delay=mean(dep_delay, na.rm=TRUE)) %>%
left_join(flights %>%
group_by(carrier, dest) %>%
summarise(n()), by=c("carrier", "dest"))
df_flights_delay_by_carrier_airport
arrange(df_flights_delay_by_carrier_airport, delay)
arrange(df_flights_delay_by_carrier_airport, dest)
# Can I disentagle effects of bad airports vs bad carriers
df_flights_delay_by_carrier_airport <- flights %>%
group_by(carrier, dest) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
group_by(carrier, dest) %>%
summarise(n()), by=c("carrier", "dest"))
arrange(df_flights_delay_by_carrier_airport, dest)
# 6. What does the sort argument to count() do. When might you use it?
?count()
arrange(df_flights_delay_by_carrier_airport, dest)
flights
flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm+TRUE))
flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE))
arrange(flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)), delay )
arrange(flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)), desc(delay))
# 3. What time of day should you fly if you want to avoid delays
# as much as possible?
flights
# 3. What time of day should you fly if you want to avoid delays
# as much as possible?
flights$hour
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE))
left_join(flights %>%
count(hour), by="hour")
count(hour0
flights %>%
count(hour)
flights %>%
count(hour)
left_join(flights %>%
count(hour), by="hour")
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
count(hour), by="hour")
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
count(hour), by="hour")
flights %>%
count(hour)
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
count(hour), by="hour")
flights %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
flights %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
select(flights)
flights
select(flights, arr_delay, flight)
filter(select(flights, arr_delay, flight), arr_delay > 0)
filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
filter(select(flights, arr_delay, flight), arr_delay > 0)
filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
filter(select(flights, arr_delay, flight, dest), arr_delay > 0) %>%
left_join(filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE)),by="dest")
filter(select(flights, arr_delay, flight, dest), arr_delay > 0) %>%
left_join(filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE)),by="dest")
delays_sum <- filter(select(flights, arr_delay, flight, dest), arr_delay > 0) %>%
left_join(filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE)),by="dest")
delays_sum$prop <- delays_sum$arr_delay / delays_sum$total_delay
delays_sum
delays_sum$prop <- (delays_sum$arr_delay / delays_sum$total_delay)*100
delays_sum
arrange(delays_sum)
arrange(delays_sum, prop)
arrange(delays_sum, desc(prop))
?lag()
flights
arrange(flights, year, month, day )
arrange(flights, year, month, day, origin, dep_time, sched_dep_time)
select(arrange(flights, year, month, day, origin, dep_time, sched_dep_time),
month, day, dep_time, schedul_dep_time, dep_delay, origin)
select(arrange(flights, year, month, day, origin, dep_time, sched_dep_time),
month, day, dep_time, sched_dep_time, dep_delay, origin)
lagged_delays <- flights %>%
arrange(origin, month, day, dep_time) %>%
group_by(origin) %>%
mutate(dep_delay_lag = lag(dep_delay)) %>%
filter(!is.na(dep_delay), !is.na(dep_delay_lag))
flights %>%
arrange(origin, month, day, dep_time) %>%
group_by(origin) %>%
mutate(dep_delay_lag = lag(dep_delay)) %>%
filter(!is.na(dep_delay), !is.na(dep_delay_lag))
select(lagged_delays, dep_delay, dep_delay_lag)
lagged_delays <- flights %>%
arrange(origin, month, day, dep_time) %>%
group_by(origin) %>%
mutate(dep_delay_lag = lag(dep_delay)) %>%
filter(!is.na(dep_delay), !is.na(dep_delay_lag))
lagged_delays %>%
group_by(dep_delay_lag) %>%
summarise(dep_delay_mean = mean(dep_delay)) %>%
ggplot(aes(y=dep_delay_mean, x= dep_delay_lag)) +
geom_point()
lagged_delays %>%
group_by(dep_delay_lag) %>%
summarise(dep_delay_mean = mean(dep_delay)) %>%
ggplot(aes(y=dep_delay_mean, x= dep_delay_lag)) +
geom_point() +
scale_x_continuous(breaks = seq(0, 1500, by=120)) +
labs(y = "Dearture Delay", x = "Previous Departure Delay")
flights
arrange(flights, air_time)
arrange(select(flights, air_time), air_time)
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_bar()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_count()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_hist()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram(x=air_time)
arrange(select(flights, air_time), air_time
arrange(select(flights, air_time), air_time)
arrange(select(flights, air_time), air_time)
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram(x=air_time)
arrange(select(flights, air_time), air_time)
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram(x=air_time)
ggplot(data=arrange(select(flights, air_time, day), air_time)) +
geom_histogram(x=air_time)
arrange(select(flights, air_time, day), air_time)
ggplot(data=arrange(select(flights, air_time, day), air_time)) +
geom_histogram(aes(x=air_time))
flights
unique(flights$dest)
flights %>%
group_by(dest) %>%
summarise(mean(air_time), na.rm=TRUE)
flights %>%
group_by(dest) %>%
summarise(mean(air_time, na.rm=TRUE))
flights %>%
count(dest, carrier)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 1) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest))) %>%
arrange(-n)
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))# %>%
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest))# %>%
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)) %>%
count(carrier)# %>%
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)) %>%
count(carrier) %>%
arrange(nn)# %>%
source('~/Desktop/qra-r-with-ds/r_book_chp_5.R', echo=TRUE)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)) %>%
count(carrier) %>%
arrange(desc(nn))# %>%
flights %>%
group_by(tail_no)
flights
flights %>%
group_by(tailnum)
flights %>%
group_by(tailnum) %>%
select(month, day, dep_delay, arr_delay)
flights %>%
group_by(tailnum) %>%
select(month, day, dep_delay, arr_delay) %>%
rank(month)
flights %>%
group_by(tailnum) %>%
select(month, day, dep_delay, arr_delay)
flights %>%
select(month, day, dep_delay, arr_delay)
flights
source('~/Desktop/qra-r-with-ds/r_book_chp_5.R', echo=TRUE)
flights %>%
select(tailnum, month, day, dep_delay, arr_delay)
flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day))
select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay)
select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks)
ranked_df <- select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks)
filter(ranked_df, tailnum = "N14228")
filter(ranked_df, tailnum = "N14228")
filter(ranked_df, tailnum == "N14228")
filter(rank_df, arr_delay >= 60)
filter(ranked_df, arr_delay >= 60)
View(filter(ranked_df, arr_delay >= 60))
View(filter(ranked_df, arr_delay >= 60, tailnum = "N564JB"))
View(filter(ranked_df, arr_delay >= 60, tailnum == "N564JB"))
ranked_df <- select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks) %>%
filter(dep_delay >= 60)
ranked_df <- select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks)
ranked_df
filter(ranked_df, dep_delay >= 60)
filter(ranked_df, dep_delay >= 60) %>%
group_by(tailnum) %>%
slice(which.min(my_ranks))
View(filter(ranked_df, dep_delay >= 60) %>%
group_by(tailnum) %>%
slice(which.min(my_ranks)))
filter(ranked_df, tailnum=="N737US")
View(filter(ranked_df, dep_delay >= 60) %>%
group_by(tailnum) %>%
slice(which.min(my_ranks)))
View(cancelled)
