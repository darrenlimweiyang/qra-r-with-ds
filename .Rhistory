# Can I disentagle effects of bad airports vs bad carriers
df_flights_delay_by_carrier_airport <- flights %>%
group_by(carrier, dest) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
group_by(carrier, dest) %>%
summarise(n()), by=c("carrier", "dest"))
arrange(df_flights_delay_by_carrier_airport, dest)
# 6. What does the sort argument to count() do. When might you use it?
?count()
arrange(df_flights_delay_by_carrier_airport, dest)
flights
flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm+TRUE))
flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE))
arrange(flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)), delay )
arrange(flights %>%
group_by(tailnum) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)), desc(delay))
# 3. What time of day should you fly if you want to avoid delays
# as much as possible?
flights
# 3. What time of day should you fly if you want to avoid delays
# as much as possible?
flights$hour
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE))
left_join(flights %>%
count(hour), by="hour")
count(hour0
flights %>%
count(hour)
flights %>%
count(hour)
left_join(flights %>%
count(hour), by="hour")
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
count(hour), by="hour")
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
count(hour), by="hour")
flights %>%
count(hour)
flights %>%
group_by(hour) %>%
summarise(delay=mean(arr_delay, na.rm=TRUE)) %>%
left_join(flights %>%
count(hour), by="hour")
flights %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
flights %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
select(flights)
flights
select(flights, arr_delay, flight)
filter(select(flights, arr_delay, flight), arr_delay > 0)
filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
filter(select(flights, arr_delay, flight), arr_delay > 0)
filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE))
filter(select(flights, arr_delay, flight, dest), arr_delay > 0) %>%
left_join(filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE)),by="dest")
filter(select(flights, arr_delay, flight, dest), arr_delay > 0) %>%
left_join(filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE)),by="dest")
delays_sum <- filter(select(flights, arr_delay, flight, dest), arr_delay > 0) %>%
left_join(filter(flights, arr_delay>0) %>%
group_by(dest) %>%
summarise(total_delay=sum(arr_delay, na.rm=TRUE)),by="dest")
delays_sum$prop <- delays_sum$arr_delay / delays_sum$total_delay
delays_sum
delays_sum$prop <- (delays_sum$arr_delay / delays_sum$total_delay)*100
delays_sum
arrange(delays_sum)
arrange(delays_sum, prop)
arrange(delays_sum, desc(prop))
?lag()
flights
arrange(flights, year, month, day )
arrange(flights, year, month, day, origin, dep_time, sched_dep_time)
select(arrange(flights, year, month, day, origin, dep_time, sched_dep_time),
month, day, dep_time, schedul_dep_time, dep_delay, origin)
select(arrange(flights, year, month, day, origin, dep_time, sched_dep_time),
month, day, dep_time, sched_dep_time, dep_delay, origin)
lagged_delays <- flights %>%
arrange(origin, month, day, dep_time) %>%
group_by(origin) %>%
mutate(dep_delay_lag = lag(dep_delay)) %>%
filter(!is.na(dep_delay), !is.na(dep_delay_lag))
flights %>%
arrange(origin, month, day, dep_time) %>%
group_by(origin) %>%
mutate(dep_delay_lag = lag(dep_delay)) %>%
filter(!is.na(dep_delay), !is.na(dep_delay_lag))
select(lagged_delays, dep_delay, dep_delay_lag)
lagged_delays <- flights %>%
arrange(origin, month, day, dep_time) %>%
group_by(origin) %>%
mutate(dep_delay_lag = lag(dep_delay)) %>%
filter(!is.na(dep_delay), !is.na(dep_delay_lag))
lagged_delays %>%
group_by(dep_delay_lag) %>%
summarise(dep_delay_mean = mean(dep_delay)) %>%
ggplot(aes(y=dep_delay_mean, x= dep_delay_lag)) +
geom_point()
lagged_delays %>%
group_by(dep_delay_lag) %>%
summarise(dep_delay_mean = mean(dep_delay)) %>%
ggplot(aes(y=dep_delay_mean, x= dep_delay_lag)) +
geom_point() +
scale_x_continuous(breaks = seq(0, 1500, by=120)) +
labs(y = "Dearture Delay", x = "Previous Departure Delay")
flights
arrange(flights, air_time)
arrange(select(flights, air_time), air_time)
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_bar()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_count()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_hist()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram()
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram(x=air_time)
arrange(select(flights, air_time), air_time
arrange(select(flights, air_time), air_time)
arrange(select(flights, air_time), air_time)
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram(x=air_time)
arrange(select(flights, air_time), air_time)
ggplot(data=arrange(select(flights, air_time), air_time)) +
geom_histogram(x=air_time)
ggplot(data=arrange(select(flights, air_time, day), air_time)) +
geom_histogram(x=air_time)
arrange(select(flights, air_time, day), air_time)
ggplot(data=arrange(select(flights, air_time, day), air_time)) +
geom_histogram(aes(x=air_time))
flights
unique(flights$dest)
flights %>%
group_by(dest) %>%
summarise(mean(air_time), na.rm=TRUE)
flights %>%
group_by(dest) %>%
summarise(mean(air_time, na.rm=TRUE))
flights %>%
count(dest, carrier)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 1) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest))) %>%
arrange(-n)
View(flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)))# %>%
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest))# %>%
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)) %>%
count(carrier)# %>%
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)) %>%
count(carrier) %>%
arrange(nn)# %>%
source('~/Desktop/qra-r-with-ds/r_book_chp_5.R', echo=TRUE)
flights %>%
group_by(dest) %>%
filter(n_distinct(carrier) > 2) %>%
group_by(carrier, dest) %>%
summarise(n=n_distinct(dest)) %>%
count(carrier) %>%
arrange(desc(nn))# %>%
flights %>%
group_by(tail_no)
flights
flights %>%
group_by(tailnum)
flights %>%
group_by(tailnum) %>%
select(month, day, dep_delay, arr_delay)
flights %>%
group_by(tailnum) %>%
select(month, day, dep_delay, arr_delay) %>%
rank(month)
flights %>%
group_by(tailnum) %>%
select(month, day, dep_delay, arr_delay)
flights %>%
select(month, day, dep_delay, arr_delay)
flights
source('~/Desktop/qra-r-with-ds/r_book_chp_5.R', echo=TRUE)
flights %>%
select(tailnum, month, day, dep_delay, arr_delay)
flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day))
select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay)
select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks)
ranked_df <- select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks)
filter(ranked_df, tailnum = "N14228")
filter(ranked_df, tailnum = "N14228")
filter(ranked_df, tailnum == "N14228")
filter(rank_df, arr_delay >= 60)
filter(ranked_df, arr_delay >= 60)
View(filter(ranked_df, arr_delay >= 60))
View(filter(ranked_df, arr_delay >= 60, tailnum = "N564JB"))
View(filter(ranked_df, arr_delay >= 60, tailnum == "N564JB"))
ranked_df <- select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks) %>%
filter(dep_delay >= 60)
ranked_df <- select(flights %>%
group_by(tailnum) %>%
mutate(my_ranks = order(month,day)), tailnum, month, day, dep_delay, arr_delay, my_ranks)
ranked_df
filter(ranked_df, dep_delay >= 60)
filter(ranked_df, dep_delay >= 60) %>%
group_by(tailnum) %>%
slice(which.min(my_ranks))
View(filter(ranked_df, dep_delay >= 60) %>%
group_by(tailnum) %>%
slice(which.min(my_ranks)))
filter(ranked_df, tailnum=="N737US")
View(filter(ranked_df, dep_delay >= 60) %>%
group_by(tailnum) %>%
slice(which.min(my_ranks)))
View(cancelled)
library(nycflights13)
library(tidyverse)
library(ggplot2)
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut))
smaller <- diamonds %>%
filter(carat < 3)
ggplot(data = smaller, mapping = aes(x = carat)) +
geom_histogram(binwidth = 0.1)
ggplot(data = smaller, mapping = aes(x = carat, colour = cut)) +
geom_freqpoly(binwidth = 0.1)
ggplot(data = smaller, mapping = aes(x = carat, color=cut)) +
geom_histogram(binwidth = 0.1)
ggplot(data = smaller, mapping = aes(x = carat, colour = cut)) +
geom_freqpoly(binwidth = 0.1)
ggplot(diamonds) +
geom_histogram(mapping = aes(x = y), binwidth = 0.5) +
coord_cartesian(ylim = c(0, 50))
ggplot(diamonds) +
geom_histogram(mapping = aes(x = y), binwidth = 0.5)
ggplot(diamonds) +
geom_histogram(mapping = aes(x = y), binwidth = 0.5) +
coord_cartesian(ylim = c(0, 50))
ggplot(diamonds) +
geom_histogram(mapping = aes(x = y), binwidth = 0.5) +
coord_cartesian(xlim = c(0, 50))
ggplot(diamonds) +
geom_histogram(mapping = aes(x = y), binwidth = 0.5) +
coord_cartesian(xlim = c(0, 10))
diamonds
?diamonds
ggplot(diamonds) +
geom_histogram(mapping(x=carat))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=carat))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=carat), binwidth = 1)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=carat), binwidth = 0.5)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=carat), bins=100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=carat), bins=50)
?diamonds
ggplot(diamonds) +
geom_histogram(mapping = aes(x=carat), bins=50)
ggplot(diamonds) +
geom_density(mapping = aes(x=carat), bins=50)
ggplot(diamonds) +
geom_density(mapping = aes(x=carats))
ggplot(diamonds) +
geom_density(mapping = aes(x=carat))
ggplot(diamonds) +
geom_density(mapping = aes(x=price))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=x), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=y), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=z), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=y), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=x), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=x), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=y), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=z), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 1000)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 10)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 100)
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 100) +
coord_cartesian(xlim = c(0, 5000))
diamonds %>%
filter(carat == 0.99)
diamonds %>%
filter(carat == 0.99) %>%
count()
diamonds %>%
filter(carat == 1) %>%
count()
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price), bins = 100) +
coord_cartesian(xlim = c(0, 5000))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price))
coord_cartesian(xlim = c(0, 5000))
coord_cartesian(xlim = c(0, 5000))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 5000))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 2500))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 500))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 250))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 300))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 400))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 500))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(0, 600))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(200, 700))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(200, 800))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(200, 1000))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(300, 650))
ggplot(diamonds) +
geom_histogram(mapping = aes(x=price)) +
coord_cartesian(xlim = c(300, 550))
diamonds2 <- diamonds %>%
mutate(y = ifelse(y < 3 | y > 20, NA, y))
diamonds2
min(diamonds2$y)
?mutate
flights
ggplot(data=flights) +
geom_histogram(mapping=aes(x=dep_time))
ggplot(data=flights) +
geom_bar(mapping=aes(x=dep_time))
ggplot(data=diamonds) +
geom_bar(mapping=aes(x=cut))
diamonds %>%
count()
diamonds
diamonds %>%
count(is.na)
diamonds %>%
group_by(cut) %>%
count()
diamonds %>%
group_by(cut) %>%
sumamrise(is.na())
diamonds %>%
group_by(cut) %>%
summmarise(is.na())
diamonds %>%
group_by(cut) %>%
summarise(is.na())
diamonds %>%
group_by(cut) %>%
summarise(is.na(cut))
is.na(diamonds$cut)
is.na(diamonds$cut) %>%
count()
is.na(diamonds$cut) %>%
sumamrise(count())
is.na(diamonds$cut) %>%
summarise(count())
table(is.na(diamonds$cut))
diamonds
table(is.na(diamonds$y))
table(is.na(diamonds$x))
table(is.na(diamonds$z))
diamonds %>%
mutate(y = ifelse(y < 3 | y > 20, NA, y))
table(is.na(diamonds$z))
table(is.na(diamonds$y))
diamonds %>%
mutate(y = ifelse(y < 3 | y > 20, NA, y), inplace=TRUE)
table(is.na(diamonds$y))
diamonds %>%
filter(y == NA)
diamonds %>%
filter(is.na(y))
diamonds %>%
filter(y < 3)
mutate(diamonds, y = ifelse(y < 3 | y > 20, NA, y))
diamonds %>%
filter(y < 3)
test = mutate(diamonds, y = ifelse(y < 3 | y > 20, NA, y))
test %>%
filter(y < 3)
table(is.na(test$y))
mean(test$y)
mean(test$x)
mean(test$y, na.rm=TRUE)
ggplot(data = diamonds, mapping = aes(x = price)) +
geom_freqpoly(mapping = aes(colour = cut), binwidth = 500)
ggplot(data = diamonds, mapping = aes(x = price)) +
geom_freqpoly(binwidth = 500)
ggplot(data = diamonds, mapping = aes(x = price)) +
geom_freqpoly(mapping = aes(colour = cut), binwidth = 500)
ggplot(data = diamonds, mapping = aes(x = price)) +
geom_freqpoly(mapping = aes(colour = cut), binwidth = 500)
ggplot(data = diamonds, mapping = aes(x = price, y = ..density..)) +
geom_freqpoly(mapping = aes(colour = cut), binwidth = 500)
ggplot(data = diamonds, mapping = aes(x = cut, y = price)) +
geom_boxplot()
